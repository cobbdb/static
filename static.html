<!doctype html>
<html>
<head>
    <title>Static - YSI YRI Report Generator</title>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.1.3/angular.min.js"></script>
    <script src="//underscorejs.org/underscore-min.js"></script>
    
    <link href="//normalize-css.googlecode.com/svn/trunk/normalize.css" rel="stylesheet">
    <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet">
    
    <script>
        Number.prototype.roundToFixed = function (radix) {
            var val = this;
            radix = radix || 0;

            val *= Math.pow(10, radix);
            val = Math.round(val);
            val /= Math.pow(10, radix);
            return val;
        };
        
        function Program(name) {
            var StatGroup = function (name) {
                return {
                    name: name,
                    totalClosed: 0,
                    successfulClosed: 0,
                    successRate: '-'
                };
            };
            return {
                name: name,
                data: [
                    StatGroup('week'),
                    StatGroup('month')
                ]
            };
        }
        
        function StaticController($scope) {
            var programNames = [
                'Janus',
                'Mobile',
                'Revenue',
                'Video',
                'On Demand',
                'Platform'
            ];
            
            $scope.programs = [];
            _(programNames).each(function (name) {
                $scope.programs.push(Program(name));
            });
            
            $scope.recalculate = function (period) {
                try {
                    var total = period.successfulClosed / period.totalClosed * 100;
                    if (_(total).isFinite()) {
                        return total.roundToFixed();
                    } else {
                        throw new Error();
                    }
                } catch (err) {
                    return '-';
                }
            };
        }
    </script>
    <style>
        .hero-unit {
            padding-top: 30px;
            margin-bottom: 0;
        }
        .program-name {
            font-weight: bold;
        }
        .program {
            padding: 0px 0;
        }
        input {
            margin: 0 !important;
        }
        input[type="button"] {
            margin-top: 10px !important;
        }
        * {
            border-radius: 0 !important;
            -webkit-border-radius: 0 !important;
            -moz-border-radius: 0 !important;
        }
    </style>
</head>
<body ng-app>
    <div class="container hero-unit" ng-controller="StaticController">
        <div style="position: absolute">
            <h1>Static</h1>
            <p>The YSI YRI Report Generator</p>
        </div>
        <div class="row text-right">
            <div class="span2 offset2" style="margin-top: 30px">Program</div>
            <div class="span1" style="margin-top: 30px">Period</div>
            <div class="span1">Total Closed</div>
            <div class="span1">Closed by Devs</div>
            <div class="span1">Success Rate</div>
        </div>
        <div class="text-right program" ng-repeat="program in programs">
            <div class="row" ng-repeat="period in program.data">
                <div ng-switch on="$index">
                    <div ng-switch-when="0">
                        <div class="span2 offset2 program-name">
                            {{ program.name }}
                        </div>
                        <div class="span1" style="font-style: italic">
                            {{ period.name }}
                        </div>
                    </div>
                    <div ng-switch-default>
                        <div class="span1 offset4" style="font-style: italic">
                            {{ period.name }}
                        </div>
                    </div>
                </div>
                <div class="span1">
                    <input type="number" class="input-mini" ng-model="period.totalClosed">
                </div>
                <div class="span1">
                    <input type="number" class="input-mini" ng-model="period.successfulClosed">
                </div>
                <div class="span1">{{ calculateRow(period) }}%</div>
            </div>
        </div>
        <div class="text-right row" style="font-weight: bold">
            <div class="span2 offset2">Totals</div>
            <div class="span1" style="font-style: italic">week</div>
            <div class="span1">{{ sumTotalClosed() }}</div>
            <div class="span1">{{ sumSuccessfulClosed() }}</div>
            <div class="span1">{{ calculateRow(period) }}%</div>
        </div>
        <div class="text-right row" style="font-weight: bold">
            <div class="span1 offset4" style="font-style: italic">month</div>
            <div class="span1">{{ sumTotalClosed() }}</div>
            <div class="span1">{{ sumSuccessfulClosed() }}</div>
            <div class="span1">{{ calculateRow(period) }}%</div>
        </div>
        <div class="text-center">
            <input type="button" class="btn btn-large btn-inverse" value="Create Report">
        </div>
    </div>
</body>
</html>
